#!/usr/bin/env bash

source /usr/local/etc/library.sh
repo_type="$(source "${BINDIR}/BACKUPS/kopia.sh"; tmpl_repository_type)"
repo_path="$(source "${BINDIR}/BACKUPS/kopia.sh"; tmpl_destination)"
docker_args=()
[[ "$repo_type" == "filesystem" ]] && docker_args=(-v "${repo_path}:/repository")
data_dir="$(source "${BINDIR}/CONFIG/nc-datadir.sh"; tmpl_data_dir)"
cache_dir="${data_dir}/.kopia"

docker run --rm -it \
  -v /usr/local/etc/kopia:/app/config \
  -v "${cache_dir}:/app/cache" \
  "${docker_args[@]}" \
  kopia/kopia:latest "${@}"
